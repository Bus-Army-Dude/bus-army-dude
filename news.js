// Sample article data (you can replace this with your actual data fetching logic)
const articles = [
    {
        id: 1,
        title: "The market's gonna boom,' says Trump as Wall Street tumbles over tariffs",
        shortDescription: "A day after President Donald Trump’s reciprocal tariffs sent global markets tumbling - and his administration urged the American public to be patient - the president struck an optimistic note.",
        content: "WASHINGTON − A day after President Donald Trump’s reciprocal tariffs sent global markets tumbling - and his administration urged the American public to be patient - the president struck an optimistic note. Wall Street and global stock exchanges took a sharp nosedive Thursday as investors braced for the possibility of a recession, after Trump imposed higher tariffs on dozens of countries − including some of America’s biggest trading partners. The S&P 500 was down 3.4% and the Dow Jones Industrial Average was down more than 1,100 points or 2.6% at 12:40 p.m.On Thursday, Trump, who has declined to rule out the possibility of a recession, compared his “Liberation Day” tariffs to surgery as he delivered a positive prognosis on the White House South Lawn. I think it's going very well. It was an operation like when a patient gets operated, he said, adding that the move was already bringing in close to $7 trillion in investment. The markets are gonna boom. The stock is gonna boom the country's gonna boom, and the rest of the world wants to see is there any way they can make a deal he said. They've taken advantage of us for many, many years. On Wednesday as he unveiled his reciprocal tariffs plan in the Rose Garden, Trump said he was charging the countries a discounted reciprocal rate “because we are being very kind as he announced tariffs ranging from 10% to 49%. In a Thursday morning post on TruthSocial, Trump said the country would emerge stronger after the operation. THE OPERATION IS OVER! THE PATIENT LIVED, AND IS HEALING, he wrote. THE PROGNOSIS IS THAT THE PATIENT WILL BE FAR STRONGER, BIGGER, BETTER, AND MORE RESILIENT THAN EVER BEFORE. MAKE AMERICA GREAT AGAIN!!! Vice President JD Vance on Thursday defended the president's tariff move and said it would take time to see the benefits of the tariff and deregulation policy. What I’d ask folks to appreciate here is that we are not going to fix things overnight, Vance said Thursday during a FOX & Friends interview. We’ve seen closing factories, we’ve seen rising inflation. President Trump is taking this economy in a different direction. For instance, China, which was previously hit with a 20% tariff to address its role in the production of synthetic opioids, received an additional 34%, bringing the total to 54%. Cambodia was hit with a 49% tariff while Thailand came in at 36%. The reciprocal tariffs will go into effect on April 9. Reciprocal. That means they do it to us, and we do it to them, Trump said from the Rose Garden. European Commission President Ursula von der Leyen said Trump’s 20% tariffs on the bloc of 27 countries is a major blow to the whole economy. The global economy will massively suffer, she said. Uncertainty will spiral and trigger the rise of further protectionism. The EU chief said she was prepared to implement countermeasures. A top House Democrat vowed to try forcing a vote to block the tariffs. I'll soon introduce a privileged resolution to force a vote on ending the made up national emergency Trump is using to justify these taxes, Rep. Greg Meeks, D-N.Y., the Foreign Affairs Committee's ranking member, wrote in a post on X. Trump just hit Americans with the largest regressive tax hike in modern history − massive tariffs on all imports, he said. While Democrats panned Trump’s tariff plans, Republicans were quick to defend the president. Rep. Rick Allen, R-Ga., said the president was undoing decades of unfair trade practices and putting American workers, businesses, and manufacturers FIRST. These reciprocal tariffs are simply leveling the playing field and will help ensure the U.S. is no longer on the losing end of global trade, he tweeted on X.",
        imageUrl: "https://www.usatoday.com/gcdn/authoring/authoring-images/2025/04/03/USAT/82795406007-20250403-t-150930-z-1525855833-rc-2-xpdaft-9-cm-rtrmadp-3-usatrumptariffstariffsformula.JPG?width=1320&height=880&fit=crop&format=pjpg&auto=webp",
        postedOn: "2025-04-03T15:33:00Z", // ISO date format
        author: "Swapna Venugopal Ramaswamy",
        category: "us"
    },
    {
        id: 2,
        title: "South Koreans are celebrating Yoon’s impeachment, but the saga is far from over Raphael Rashid in Seoul and Justin McCurry",
        shortDescription: "Whoever becomes president later this year has unenviable task of healing divisions and rebuilding trust in democratic institutions",
        content: "It had been a long and at times intolerable wait. But the South Korean constitutional court’s decision on Friday to oust Yoon Suk Yeol from office may have restored the public’s faith in their democracy. For 22 minutes, millions of South Koreans held their breath as the chief justice of the constitutional court, Moon Hyung-bae, began delivering the court’s verdict on Yoon’s impeachment over his chaotic declaration of martial law in December. With each damning statement, Moon raised the hopes of the crowds outside who had been demanding the suspended president’s permanent removal from office. Yoon’s actions, he said, had constituted a serious challenge to democracy, adding that the 64-year-old conservative populist had committed a grave betrayal of the people’s trust in bringing about South Korea’s worst political crisis since it became a democracy in the late 1980s. When Moon finally uttered the words: The defendant president Yoon Suk Yeol is hereby removed from office, the crowd erupted with cheers. The ruling sets in motion a 60-day countdown to elect a new leader, the date to be confirmed within 10 days by the acting president, Han Duck-soo. Political parties are already scrambling to select candidates, with the Democratic party’s Lee Jae-myung – a longtime Yoon nemesis – currently leading the polls. Yoon’s conservative People Power party, meanwhile, has the unenviable task of selecting a candidate who is untainted by association with Yoon’s failed administration. The national assembly’s first impeachment vote in December was an opportunity for the party to distance itself from Yoon. Instead, People Power MPs doubled down, boycotting the vote and continuing to back their embattled leader. They then amplified what many believe to be Yoon’s groundless claims that previous elections, including a national assembly vote earlier in the year, had been mired in voting fraud. The conspiracy theories found fertile ground among Yoon’s supporters, who adopted Trump-style slogans such as stop the stealing as they took to the streets. By invoking cold war language about pro-North Korean, anti-state forces to describe his political opponents, analysts said Yoon deepened the political divide in an already polarised country. Whoever becomes president later this year faces the unenviable task of healing those divisions and rebuilding trust in the democratic institutions that Yoon so casually undermined. The ruling marked the end of a tumultuous three years for the conservative populist. The former senior prosecutor who had led the case for impeachment against the then president, Park Geun-hye in 2017, now has the same ignominious postscript to his presidency. Having won the 2022 election – beating the liberal Lee by the slimmest of margins – Yoon was initially admired as an assertive and strong-willed leader, until those qualities were exposed as an unwillingness to compromise or accept criticism. As he struggled to implement budgets and key policies in the opposition-controlled national assembly, Yoon grew increasingly irritable, targeting critical journalists, confronting striking doctors, blocking attempts to investigate corruption allegations involving the first lady, Kim Keon Hee, and labelling opposition MPs as a den of criminals working in cahoots with communist North Korea. Human rights activists welcomed Friday’s verdict. In a statement, Human Rights Watch said Yoon’s attempt to impose martial law had posed a grave threat to human rights and the rule of law. It added: If martial law had been maintained, South Koreans would have faced the risk of arrest and detention without trial as well as severe restrictions on their freedom of expression and assembly, among other human rights violations. The constitutional court’s ruling was a decisive step to uphold human rights protections and democratic values. Some characterise Yoon’s removal as the start of a process to restore public faith in South Korea as a liberal democracy with a successful economy and a culture admired around the world. Leif-Eric Easley, a professor at Ewha University in Seoul, said the court’s verdict had removed a major source of uncertainty. And not a moment too soon, given how the next administration in Seoul must navigate North Korea’s military threats, China’s diplomatic pressure, and Trump’s trade tariffs. It is a sentiment shared by anti-Yoon protesters who had gathered outdoors to watch a live broadcast of the verdict. When his removal was announced, they cheered, danced and cried. When the dismissal was finally declared, the cheers were so loud it felt like the rally was being swept away, said Kim Min-ji, a 25-year-old protester. We cried tears and shouted that we, the citizens, had won! But the saga is far from over. Few believe that candidates and voters in the forthcoming presidential election will be able to put the acrimony of the past four months behind them, while Yoon faces a separate criminal trial on charges of insurrection – a crime that carries a maximum term of life imprisonment or the death penalty. If people start refusing to accept any election outcome that is unfavourable to them, the other side will start doing the same, said Kim Tae-hyung, a professor at Soongsil University in Seoul. If that cycle continues, trust in democracy will completely collapse.",
        imageUrl: "https://i.guim.co.uk/img/media/7053e01bdde66c990acd8ee62b2401aaccd7d607/0_0_5197_3119/master/5197.jpg?width=700&dpr=2&s=none&crop=none",
        postedOn: "2025-04-04T09:51:00Z", // ISO date format
        author: "Raphael Rashid in Seoul and Justin McCurry",
        category: "world"
    },
    {
        id: 3,
        title: "Donald Trump floats China tariff relief in exchange for TikTok sale approval",
        shortDescription: "US president suggests he is open to horse-trading a day after imposing severe import levies on Chinese goods",
        content: "President Donald Trump has suggested he could cut tariffs on Chinese goods if Beijing allows ByteDance, the Chinese owner of TikTok, to divest the hugely popular video sharing app to avoid a ban in the US. We have a situation with TikTok where China will probably say we’ll approve a deal, but will you do something on the tariffs, Trump said aboard Air Force One. The tariffs give us great power to negotiate. The comments came one day after Trump imposed reciprocal tariffs on dozens of nations, including a 34%  levy on imports from China that followed the 20% tariff he imposed earlier this year. Trump also said his administration was very close to reaching a deal with multiple investors that would allow TikTok to continue to operate in the US. Congress last year passed legislation requiring ByteDance to divest the app or face a nationwide ban. Trump extended the deadline for divestment until Saturday. Lawmakers passed the legislation to address security concerns about possible Chinese government influence over TikTok’s algorithm. Security officials are also concerned that ByteDance’s ownership of TikTok would enable Beijing to obtain the personal data of millions of Americans. We’re very close to a deal with a very good group of people, Trump said. Earlier on Thursday, vice-president JD Vance told Fox News the deal would come out before the deadline. The White House this week held talks to thrash out the contours of a deal that would be palatable to Republicans, as well as ByteDance and the Chinese government, which would need to give its blessing. The administration has been weighing a proposal to spin off TikTok from its Chinese parent. It would create a new US entity and include fresh American investment to dilute the ownership stakes of Chinese investors, according to multiple people familiar with the matter. Under the proposal, new outside investors, including Andreessen Horowitz, Blackstone, Silver Lake and other big private capital firms, would own about half of TikTok’s US business, the people said.  Large existing investors in TikTok, including General Atlantic, Susquehanna, KKR and Coatue, would hold 30% of the US entity, while ByteDance would keep a stake at just below 20%. This would adhere to requirements in the US law that no more than a fifth of the company be controlled by a foreign adversary. Oracle, meanwhile, would provide data security to the company.  But one big flashpoint is who would control TikTok’s highly sought-after algorithm. One option under discussion was that ByteDance would continue to develop and operate the algorithm — which has been a central demand of the Chinese government — while the new US group could access it through a licensing agreement, the people said.  However, China hawks and legal academics have argued that the algorithm needs to be fully operated by the US entity to meet the requirements of the legislation. Several members of the Trump administration, including secretary of state Marco Rubio and national security adviser Mike Waltz, were vocal opponents of allowing China to retain control of the app when they served in Congress. The Chinese embassy in Washington did not respond to a request for comment. A ByteDance representative did not immediately respond to a request for comment.",
        imageUrl: "https://www.ft.com/__origami/service/image/v2/images/raw/ftcms%3A2f217351-365a-4f93-b22a-0deba9dcdf4b?source=next-article&fit=scale-down&quality=highest&width=700&dpr=2",
        postedOn: "2025-04-03T19:02:00Z", // ISO date format
        author: "Demetri Sevastopulo & Hannah Murphy",
        category: "business"
    }
    // Add more articles as needed
];

// Function to format the date into "X hours ago" or "X minutes ago"
function timeAgo(date) {
    const now = new Date();
    const diffInSeconds = Math.floor((now - new Date(date)) / 1000);
    const diffInMinutes = Math.floor(diffInSeconds / 60);
    const diffInHours = Math.floor(diffInMinutes / 60);
    const diffInDays = Math.floor(diffInHours / 24);

    if (diffInSeconds < 60) return `${diffInSeconds} second${diffInSeconds !== 1 ? 's' : ''} ago`;
    if (diffInMinutes < 60) return `${diffInMinutes} minute${diffInMinutes !== 1 ? 's' : ''} ago`;
    if (diffInHours < 24) return `${diffInHours} hour${diffInHours !== 1 ? 's' : ''} ago`;
    return `${diffInDays} day${diffInDays !== 1 ? 's' : ''} ago`;
}

// Function to create an article card and append it to the news container
function createArticleCard(article) {
    const articleCard = document.createElement('div');
    articleCard.classList.add('article-card');
    articleCard.dataset.articleId = article.id; // Add a data attribute to identify the article

    // Article image
    const image = document.createElement('img');
    image.src = article.imageUrl;
    image.alt = article.title;
    articleCard.appendChild(image);

    // Article category
    const category = document.createElement('div');
    category.classList.add('article-category');
    category.textContent = article.category; // Display category on the card
    articleCard.appendChild(category);

    // Article title
    const title = document.createElement('h3');
    title.classList.add('article-title');
    title.textContent = article.title;
    articleCard.appendChild(title);

    // Short description
    const description = document.createElement('p');
    description.classList.add('short-description');
    description.textContent = article.shortDescription;
    articleCard.appendChild(description);

    // Posted by & time ago (e.g., "4 hours ago")
    const postedBy = document.createElement('div');
    postedBy.classList.add('posted-by');
    postedBy.innerHTML = `<span class="posted-on">${timeAgo(article.postedOn)}</span> <span class="author">by ${article.author}</span>`;
    articleCard.appendChild(postedBy);

    // Add a click event to open the article in the modal
    articleCard.addEventListener('click', () => openArticleModal(article));

    // Append the article card to the news container
    document.getElementById('news-container').appendChild(articleCard);
}

// Function to open the article modal
function openArticleModal(article) {
    // Set modal content based on the article
    document.getElementById('category-name').textContent = article.category;
    document.getElementById('article-title').textContent = article.title;
    document.getElementById('short-description').textContent = article.shortDescription;
    document.getElementById('author').textContent = article.author;
    document.getElementById('date').textContent = timeAgo(article.postedOn);
    document.getElementById('article-image').src = article.imageUrl;
    document.getElementById('article-image').alt = article.title;
    document.getElementById('article-content').textContent = article.content;

    // Show the modal
    document.getElementById('modal').style.display = 'block';
}

// Function to close the modal
function closeModal() {
    document.getElementById('modal').style.display = 'none';
}

// Function to filter articles by time range and category
function filterArticles(range, category) {
    let filteredArticles = articles;

    const now = new Date();

    // First, filter by time range
    switch (range) {
        case 'past-hour':
            filteredArticles = filteredArticles.filter(article => now - new Date(article.postedOn) <= 60 * 60 * 1000);
            break;
        case 'past-24-hours':
            filteredArticles = filteredArticles.filter(article => now - new Date(article.postedOn) <= 24 * 60 * 60 * 1000);
            break;
        case 'past-week':
            filteredArticles = filteredArticles.filter(article => now - new Date(article.postedOn) <= 7 * 24 * 60 * 60 * 1000);
            break;
        case 'past-year':
            filteredArticles = filteredArticles.filter(article => now - new Date(article.postedOn) <= 365 * 24 * 60 * 60 * 1000);
            break;
        default:
            break; // 'anytime' - no time filter
    }

    // Then, filter by category
    console.log("Selected category:", category); // Log the selected category

    if (category !== 'home' && category !== 'all') {
        filteredArticles = filteredArticles.filter(article => {
            console.log("Article category:", article.category); // Log each article's category
            const matches = article.category.toLowerCase() === category.toLowerCase();
            console.log("Match:", matches); // Log if there's a match
            return matches;
        });
    }

    // Clear the existing articles and load filtered ones
    document.getElementById('news-container').innerHTML = '';
    filteredArticles.forEach(article => {
        createArticleCard(article);
    });
}

// Function to load all articles initially
function loadArticles() {
    articles.forEach(article => {
        createArticleCard(article);
    });
}

// Function to handle navigation tab clicks
function handleNavTabClick(event) {
    event.preventDefault(); // Prevent the default link behavior
    const category = event.target.dataset.category;
    const timeFilterValue = document.getElementById('time-filter').value;
    filterArticles(timeFilterValue, category);

    // Update the active class on the navigation tabs
    document.querySelectorAll('.nav-tabs a').forEach(link => {
        link.classList.remove('active');
    });
    event.target.classList.add('active');
}

// Wait for DOM content to be loaded before initializing
document.addEventListener('DOMContentLoaded', () => {
    loadArticles(); // Load all articles initially

    // Add event listeners to the navigation tabs
    const navTabs = document.querySelectorAll('.nav-tabs a');
    navTabs.forEach(tab => {
        tab.addEventListener('click', handleNavTabClick);
    });

    // Add event listener to the category dropdown
    const categorySelect = document.getElementById('category-select');
    categorySelect.addEventListener('change', (event) => {
        const selectedCategory = event.target.value;
        const timeFilterValue = document.getElementById('time-filter').value;
        filterArticles(timeFilterValue, selectedCategory);
    });

    // Add event listener to the time filter dropdown
    const timeFilter = document.getElementById('time-filter');
    timeFilter.addEventListener('change', (event) => {
        const activeCategory = document.querySelector('.nav-tabs a.active');
        const categoryValue = activeCategory ? activeCategory.dataset.category : document.getElementById('category-select').value; // Get category from dropdown if no active nav tab
        filterArticles(event.target.value, categoryValue);
    });

    // Add event listener for the close button
    const closeButton = document.querySelector('.close-button');
    if (closeButton) {
        closeButton.addEventListener('click', closeModal);
    }

    // Add event listener for the Escape key to close the modal
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal();
        }
    });

    // Initially set the 'Home' tab as active
    const homeTab = document.querySelector('.nav-tabs a[data-category="home"]');
    if (homeTab) {
        homeTab.classList.add('active');
    }
});
